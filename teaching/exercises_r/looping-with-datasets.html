<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Looping with datasets | Various exercises on programming in R</title>
  <meta name="description" content="A brief set of exercises on control flow and loops in R" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Looping with datasets | Various exercises on programming in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A brief set of exercises on control flow and loops in R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Looping with datasets | Various exercises on programming in R" />
  
  <meta name="twitter:description" content="A brief set of exercises on control flow and loops in R" />
  

<meta name="author" content="Bram Kuijper" />


<meta name="date" content="2022-01-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="slightly-more-advanced-for-loops.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Exercises</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#prior-knowledge-about-r"><i class="fa fa-check"></i><b>1.1</b> Prior knowledge about R</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#finding-help"><i class="fa fa-check"></i><b>1.1.1</b> Finding help</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#different-types-of-variables"><i class="fa fa-check"></i><b>1.1.2</b> Different types of variables</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#operators"><i class="fa fa-check"></i><b>1.1.3</b> Operators</a></li>
<li class="chapter" data-level="1.1.4" data-path="index.html"><a href="index.html#control-flow"><i class="fa fa-check"></i><b>1.1.4</b> Control flow</a></li>
<li class="chapter" data-level="1.1.5" data-path="index.html"><a href="index.html#sizes-of-things"><i class="fa fa-check"></i><b>1.1.5</b> Sizes of things</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#selecting-subsets-of-your-data"><i class="fa fa-check"></i><b>1.2</b> Selecting subsets of your data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#loop-structures"><i class="fa fa-check"></i><b>1.2.1</b> Loop structures</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#some-additional-coding-tips"><i class="fa fa-check"></i><b>1.3</b> Some additional coding tips:</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#dont-ignore-the-links-and-hints"><i class="fa fa-check"></i><b>1.3.1</b> Don’t ignore the links and hints</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#try-out-examples-for-yourself"><i class="fa fa-check"></i><b>1.3.2</b> Try out examples for yourself</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#search-enginges-are-your-friend"><i class="fa fa-check"></i><b>1.3.3</b> Search enginges are your friend</a></li>
<li class="chapter" data-level="1.3.4" data-path="index.html"><a href="index.html#comment-your-code"><i class="fa fa-check"></i><b>1.3.4</b> Comment your code</a></li>
<li class="chapter" data-level="1.3.5" data-path="index.html"><a href="index.html#keep-an-error-record"><i class="fa fa-check"></i><b>1.3.5</b> Keep an error record</a></li>
<li class="chapter" data-level="1.3.6" data-path="index.html"><a href="index.html#find-out-the-root-of-errors-using-traceback"><i class="fa fa-check"></i><b>1.3.6</b> Find out the root of errors using <code>traceback()</code></a></li>
<li class="chapter" data-level="1.3.7" data-path="index.html"><a href="index.html#inspect-values-using-print-or-use-rs-debugger"><i class="fa fa-check"></i><b>1.3.7</b> Inspect values using <code>print()</code> or use R’s debugger</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="using-loops-to-calculate-sums-and-sums-of-squares.html"><a href="using-loops-to-calculate-sums-and-sums-of-squares.html"><i class="fa fa-check"></i><b>2</b> Using loops to calculate sums and sums of squares</a>
<ul>
<li class="chapter" data-level="2.1" data-path="using-loops-to-calculate-sums-and-sums-of-squares.html"><a href="using-loops-to-calculate-sums-and-sums-of-squares.html#printEx"><i class="fa fa-check"></i><b>2.1</b> Exercise: printing elements from a vector</a></li>
<li class="chapter" data-level="2.2" data-path="using-loops-to-calculate-sums-and-sums-of-squares.html"><a href="using-loops-to-calculate-sums-and-sums-of-squares.html#exercise-printing-every-nth-row-from-a-data.frame"><i class="fa fa-check"></i><b>2.2</b> Exercise: printing every <span class="math inline">\(n\)</span>th row from a <code>data.frame</code></a></li>
<li class="chapter" data-level="2.3" data-path="using-loops-to-calculate-sums-and-sums-of-squares.html"><a href="using-loops-to-calculate-sums-and-sums-of-squares.html#sum"><i class="fa fa-check"></i><b>2.3</b> Exercise: summing a vector</a></li>
<li class="chapter" data-level="2.4" data-path="using-loops-to-calculate-sums-and-sums-of-squares.html"><a href="using-loops-to-calculate-sums-and-sums-of-squares.html#sumSq"><i class="fa fa-check"></i><b>2.4</b> Sums of squares</a></li>
<li class="chapter" data-level="2.5" data-path="using-loops-to-calculate-sums-and-sums-of-squares.html"><a href="using-loops-to-calculate-sums-and-sums-of-squares.html#sum-only-if-larger-than-x"><i class="fa fa-check"></i><b>2.5</b> Sum only if larger than <span class="math inline">\(x\)</span></a></li>
<li class="chapter" data-level="2.6" data-path="using-loops-to-calculate-sums-and-sums-of-squares.html"><a href="using-loops-to-calculate-sums-and-sums-of-squares.html#separate-sums-for-odd-and-even-numbers"><i class="fa fa-check"></i><b>2.6</b> Separate sums for odd and even numbers</a></li>
<li class="chapter" data-level="2.7" data-path="using-loops-to-calculate-sums-and-sums-of-squares.html"><a href="using-loops-to-calculate-sums-and-sums-of-squares.html#produce-a-vector-of-cumulative-values"><i class="fa fa-check"></i><b>2.7</b> Produce a vector of cumulative values</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="slightly-more-advanced-for-loops.html"><a href="slightly-more-advanced-for-loops.html"><i class="fa fa-check"></i><b>3</b> Slightly more advanced for loops</a>
<ul>
<li class="chapter" data-level="3.1" data-path="slightly-more-advanced-for-loops.html"><a href="slightly-more-advanced-for-loops.html#exercise-a-list-of-random-letters"><i class="fa fa-check"></i><b>3.1</b> Exercise: a list of random letters</a></li>
<li class="chapter" data-level="3.2" data-path="slightly-more-advanced-for-loops.html"><a href="slightly-more-advanced-for-loops.html#exercise-changes-in-state-over-time"><i class="fa fa-check"></i><b>3.2</b> Exercise: changes in state over time</a></li>
<li class="chapter" data-level="3.3" data-path="slightly-more-advanced-for-loops.html"><a href="slightly-more-advanced-for-loops.html#exercise-select-columns-of-a-data.frame-containing-floating-point-numbers"><i class="fa fa-check"></i><b>3.3</b> Exercise: select columns of a <code>data.frame</code> containing floating-point numbers</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="slightly-more-advanced-for-loops.html"><a href="slightly-more-advanced-for-loops.html#hint-1-data-types"><i class="fa fa-check"></i><b>3.3.1</b> Hint 1: data types</a></li>
<li class="chapter" data-level="3.3.2" data-path="slightly-more-advanced-for-loops.html"><a href="slightly-more-advanced-for-loops.html#hint-2-data.frame-dimensions"><i class="fa fa-check"></i><b>3.3.2</b> Hint 2: data.frame dimensions</a></li>
<li class="chapter" data-level="3.3.3" data-path="slightly-more-advanced-for-loops.html"><a href="slightly-more-advanced-for-loops.html#hint-3-select-columns-based-on-a-vector"><i class="fa fa-check"></i><b>3.3.3</b> Hint 3: select columns based on a vector</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="slightly-more-advanced-for-loops.html"><a href="slightly-more-advanced-for-loops.html#nested-for-loops"><i class="fa fa-check"></i><b>3.4</b> Nested for loops</a></li>
<li class="chapter" data-level="3.5" data-path="slightly-more-advanced-for-loops.html"><a href="slightly-more-advanced-for-loops.html#parameter-combinations"><i class="fa fa-check"></i><b>3.5</b> Parameter combinations</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="looping-with-datasets.html"><a href="looping-with-datasets.html"><i class="fa fa-check"></i><b>4</b> Looping with datasets</a>
<ul>
<li class="chapter" data-level="4.1" data-path="looping-with-datasets.html"><a href="looping-with-datasets.html#preliminaries"><i class="fa fa-check"></i><b>4.1</b> Preliminaries</a></li>
<li class="chapter" data-level="4.2" data-path="looping-with-datasets.html"><a href="looping-with-datasets.html#obtaining-a-list-of-files"><i class="fa fa-check"></i><b>4.2</b> Obtaining a list of files</a></li>
<li class="chapter" data-level="4.3" data-path="looping-with-datasets.html"><a href="looping-with-datasets.html#fileList"><i class="fa fa-check"></i><b>4.3</b> Obtaining a list of files with full path names</a></li>
<li class="chapter" data-level="4.4" data-path="looping-with-datasets.html"><a href="looping-with-datasets.html#open-a-single-file"><i class="fa fa-check"></i><b>4.4</b> Open a single file</a></li>
<li class="chapter" data-level="4.5" data-path="looping-with-datasets.html"><a href="looping-with-datasets.html#forLoop"><i class="fa fa-check"></i><b>4.5</b> Getting information about each file within a <code>for</code>-loop</a></li>
<li class="chapter" data-level="4.6" data-path="looping-with-datasets.html"><a href="looping-with-datasets.html#accumulating-all-tibbles-into-a-single-big-tibble"><i class="fa fa-check"></i><b>4.6</b> Accumulating all <code>tibble</code>s into a single big <code>tibble</code></a></li>
<li class="chapter" data-level="4.7" data-path="looping-with-datasets.html"><a href="looping-with-datasets.html#plotting-the-data"><i class="fa fa-check"></i><b>4.7</b> Plotting the data</a></li>
<li class="chapter" data-level="4.8" data-path="looping-with-datasets.html"><a href="looping-with-datasets.html#data-modification-conversion"><i class="fa fa-check"></i><b>4.8</b> Data modification / conversion</a></li>
<li class="chapter" data-level="4.9" data-path="looping-with-datasets.html"><a href="looping-with-datasets.html#a-further-aside-regular-expressions"><i class="fa fa-check"></i><b>4.9</b> A further aside: regular expressions</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="looping-with-datasets.html"><a href="looping-with-datasets.html#regular-expressions-to-the-rescue"><i class="fa fa-check"></i><b>4.9.1</b> Regular expressions to the rescue</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Various exercises on programming in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="looping-with-datasets" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Looping with datasets</h1>
<p>In this set of exercises, we will use existing
datasets and use looping techniques to read in the data.
For example, let’s say you have 10 datasets which you
need to read into R into one big dataframe. How to go
about this? Along the way you will encounter a bunch of functions from
various packages that are helpful when working with data files.</p>
<div id="preliminaries" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Preliminaries</h2>
<p>When generating large databases, we typically have to join together multiple files. Let us download and save a zip archive containing a bunch of Excel files from
<a href="https://github.com/bramkuijper/stress/raw/master/figs/compare_dp/some_data.zip">here</a>. Unzip the folder in some directory.</p>
<p>There are also some other files in the zip file, they should be maintained there for the sake of the exercise.</p>
</div>
<div id="obtaining-a-list-of-files" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Obtaining a list of files</h2>
<p>Use the function <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/list.files.html"><code>list.files()</code></a> to return a list of files starting with <code>sheet_</code> and with the extension <code>.xls</code>. The list should return no other files, and hence you will have to make use of the <code>pattern</code> argument of the <code>list.files()</code> function to only list the desired files. The resulting output should look like the following:</p>
<pre><code>##  [1] &quot;sheet_1.xls&quot;  &quot;sheet_10.xls&quot; &quot;sheet_2.xls&quot;  &quot;sheet_3.xls&quot;  &quot;sheet_4.xls&quot; 
##  [6] &quot;sheet_5.xls&quot;  &quot;sheet_6.xls&quot;  &quot;sheet_7.xls&quot;  &quot;sheet_8.xls&quot;  &quot;sheet_9.xls&quot;</code></pre>
<p>Hence, other files that are contained in the zip folder, like <code>another_excel_file.xls</code> or <code>sheet_other.txt</code>, should not feature in the resulting list.</p>
</div>
<div id="fileList" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Obtaining a list of files with full path names</h2>
<p>Again, use the function <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/list.files.html"><code>list.files()</code></a> from above, but make sure that it returns the complete path names, rather than just only the names of the sheets. Read the documentation of <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/list.files.html"><code>list.files()</code></a> to see which argument(s) you will have to tweak in order for it to return full path names. Output should look like the following, except that your file system is different:</p>
<pre><code>##  [1] &quot;/Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_1.xls&quot; 
##  [2] &quot;/Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_10.xls&quot;
##  [3] &quot;/Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_2.xls&quot; 
##  [4] &quot;/Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_3.xls&quot; 
##  [5] &quot;/Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_4.xls&quot; 
##  [6] &quot;/Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_5.xls&quot; 
##  [7] &quot;/Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_6.xls&quot; 
##  [8] &quot;/Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_7.xls&quot; 
##  [9] &quot;/Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_8.xls&quot; 
## [10] &quot;/Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_9.xls&quot;</code></pre>
<p>In future uses of <code>list.files()</code>, retaining the full path name saves a lot of hassle, as it means that any future script can use the output of <code>list.files()</code> without having the locate the actual directory of the excel sheets.</p>
<p>We store the list of files that you obtained using the <code>list.files()</code> function above for future use, in a variable <code>xls_sheet_list</code>.</p>
</div>
<div id="open-a-single-file" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Open a single file</h2>
<p>Use the <a href="https://readxl.tidyverse.org/reference/read_excel.html"><code>read_excel()</code></a> function from the <a href="https://readxl.tidyverse.org/">readxl</a> package to read the first excel file of the list (i.e., <code>xls_sheet_list[[1]]</code>) into a variable. Specifically, <a href="https://readxl.tidyverse.org/reference/read_excel.html"><code>read_excel()</code></a> reads data from the excel sheet into a so-called <a href="https://tibble.tidyverse.org/"><code>tibble</code></a>, which is <a href="https://www.tidyverse.org/"><code>tidyverse</code></a> ’s more modern version of a <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/data.frame.html"><code>data.frame</code></a>.</p>
<p>Subsequently, use <code>print()</code> to display the file’s path name and then, below, print the first five lines of the resulting tibble. One can do so by using the <a href="https://dplyr.tidyverse.org/reference/slice.html"><code>slice_head()</code></a> function from the <a href="https://dplyr.tidyverse.org/"><code>dplyr</code></a> package. The resulting output should look like the following:</p>
<pre><code>## [1] &quot;/Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_1.xls&quot;</code></pre>
<pre><code>## # A tibble: 5 × 3
##   treatment individual  size
##       &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;
## 1         1          1  3.27
## 2         2          1  5.87
## 3         3          1  9.25
## 4         1          2  2.93
## 5         2          2  5.25</code></pre>
</div>
<div id="forLoop" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Getting information about each file within a <code>for</code>-loop</h2>
<p>Now we will use a <code>for</code>-loop to go through the list of files and read each file into a <code>tibble</code> using <a href="https://readxl.tidyverse.org/reference/read_excel.html"><code>read_excel()</code></a>. Subsequently, we can then request some information about the current excel sheet by interrogating the resulting <code>tibble</code>. Here, we merely print the path name of each file (which you already have done previously), the number of rows contained in the <code>tibble</code> (using either <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/nrow.html"><code>nrow()</code></a> or <code>tidyverse</code>’s <a href="https://dplyr.tidyverse.org/reference/tally.html"><code>tally()</code></a>) and the names of all the columns using the <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/names.html"><code>names()</code></a> function. Hence, output should look like the following:</p>
<pre><code>## [1] &quot;path name: /Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_1.xls&quot;
## [1] &quot;rows: 30&quot;
## [1] &quot;column names: treatment,individual,size&quot;
## [1] &quot;path name: /Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_10.xls&quot;
## [1] &quot;rows: 30&quot;
## [1] &quot;column names: treatment,individual,size&quot;
## [1] &quot;path name: /Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_2.xls&quot;
## [1] &quot;rows: 30&quot;
## [1] &quot;column names: treatment,individual,size&quot;
## [1] &quot;path name: /Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_3.xls&quot;
## [1] &quot;rows: 30&quot;
## [1] &quot;column names: treatment,individual,size&quot;
## [1] &quot;path name: /Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_4.xls&quot;
## [1] &quot;rows: 30&quot;
## [1] &quot;column names: treatment,individual,size&quot;
## [1] &quot;path name: /Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_5.xls&quot;
## [1] &quot;rows: 30&quot;
## [1] &quot;column names: treatment,individual,size&quot;
## [1] &quot;path name: /Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_6.xls&quot;
## [1] &quot;rows: 30&quot;
## [1] &quot;column names: treatment,individual,size&quot;
## [1] &quot;path name: /Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_7.xls&quot;
## [1] &quot;rows: 30&quot;
## [1] &quot;column names: treatment,individual,size&quot;
## [1] &quot;path name: /Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_8.xls&quot;
## [1] &quot;rows: 30&quot;
## [1] &quot;column names: treatment,individual,size&quot;
## [1] &quot;path name: /Users/bram/Projects/exercises_r/r_exercises_bookdown/code//sheet_9.xls&quot;
## [1] &quot;rows: 30&quot;
## [1] &quot;column names: treatment,individual,size&quot;</code></pre>
</div>
<div id="accumulating-all-tibbles-into-a-single-big-tibble" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Accumulating all <code>tibble</code>s into a single big <code>tibble</code></h2>
<p>Now try to accumulate all <code>tibble</code>s into a big one. Before we start our <code>for</code> loop, we assign an empty <code>tibble</code> (i.e., <code>tibble()</code>) to a variable, say <code>super_tbl</code>. Starting with an empty <code>tibble</code> makes sure that when we run our script again, <code>super_tbl</code> does not retain the contents of any previous runs of the same script.</p>
<p>Then, during each iteration of the <code>for</code>-loop, we append the contents of each excel sheet to this <code>super_tbl</code> variable by using the function <a href="https://dplyr.tidyverse.org/reference/bind.html"><code>bind_rows()</code></a>. We then assign the result of this function back to <code>super_tbl</code>, so that <code>super_tbl</code> grows during each iteration with the contents of each excel sheet.</p>
<p>Finally, we then just use <code>print(super_tbl)</code> and the <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/summary.html"><code>summary()</code></a> function to inspect the result</p>
<pre><code>## # A tibble: 300 × 3
##    treatment individual  size
##        &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;
##  1         1          1  3.27
##  2         2          1  5.87
##  3         3          1  9.25
##  4         1          2  2.93
##  5         2          2  5.25
##  6         3          2  9.58
##  7         1          3  4.18
##  8         2          3  6.27
##  9         3          3  9.37
## 10         1          4  1.40
## # … with 290 more rows</code></pre>
<pre><code>##    treatment   individual        size        
##  Min.   :1   Min.   : 1.0   Min.   : 0.4171  
##  [ reached getOption(&quot;max.print&quot;) -- omitted 5 rows ]</code></pre>
</div>
<div id="plotting-the-data" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Plotting the data</h2>
<p>The next task is to use <a href="https://ggplot2.tidyverse.org/"><code>ggplot2</code></a> to plot the contents of <code>super_tbl</code>. Specifically, we plot the size on the <span class="math inline">\(y\)</span>-axis and the different treatments on the <span class="math inline">\(x\)</span>-axis, while the colors of the points should reflect the different individuals. We use points, rather than lines, by using <a href="https://ggplot2.tidyverse.org/reference/geom_point.html"><code>geom_point()</code></a>. On <a href="https://ggplot2.tidyverse.org/"><code>ggplot2</code></a>’s website you can also download an elegant cheat sheet that is very helpful in achieving this.</p>
<p><img src="03-datasets_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="data-modification-conversion" class="section level2" number="4.8">
<h2><span class="header-section-number">4.8</span> Data modification / conversion</h2>
<p>As you can see when you <code>print()</code> the contents of <code>super_tbl</code>, all data types have the type of a <code>&lt;dbl&gt;</code> (double), which stands for double-precision floating point value. Such floating point values are typically used for data which varies in a continuous fashion, as is the case for the <code>size</code> column in <code>super_tbl</code>.</p>
<p>However, we often code treatments, and sometimes also individuals (if there are only a few, like here), as discrete factors at a nominal scale, meaning that number ‘1’ is not necessarily lower than ‘2’, it is merely an identifier of that treatment or individual. To accomplish this, we convert the <code>individual</code> and <code>treatment</code> column from <code>&lt;dbl&gt;</code> to <code>&lt;fct&gt;</code>, which stands for factor.</p>
<p>To convert values into factors, we might either use the old-style function <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/factor.html"><code>as.factor()</code></a> or we might use the more modern <a href="https://haven.tidyverse.org/reference/as_factor.html"><code>as_factor()</code></a> function from the <a href="https://haven.tidyverse.org/index.html">haven</a> package. For this example there is no difference between both functions, but in general <code>as_factor()</code> is slightly more generic.</p>
<p>How to change our data using the <code>as_factor()</code> function? What we can do is apply the function to the columns in question, by using the <a href="https://dplyr.tidyverse.org/reference/mutate.html"><code>mutate()</code></a> function from the <code>dplyr()</code> package. Using this <code>mutate()</code> function (you have been checking the examples on the manual page, right?), we can then add two new columns to our data frame, say <code>individual_fac</code> and <code>treatment_fac</code> which reflect our new factor data.</p>
<p>If we now plot our new <code>individual_fac</code> and <code>treatment_fac</code> columns, our plot will look slightly different:</p>
<p><img src="03-datasets_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Can you describe what is different between this plot and the previous one and why?</p>
</div>
<div id="a-further-aside-regular-expressions" class="section level2" number="4.9">
<h2><span class="header-section-number">4.9</span> A further aside: regular expressions</h2>
<p>The next exercise focuses on changing the data during the <code>for</code> loop that we used in section @ref{forLoop}.</p>
<p>Consider the following scenario: your supervisor tells you (belatedly, as always) that they have omitted some relevant detail in the previous analysis. It turns out that the size measurements in the first 4 excel sheets (i.e., <code>sheet_1.xls</code>, <code>sheet_2.xls</code>, <code>sheet_3.xls</code> and <code>sheet_4.xls</code>) were performed on a different breed of individuals (breed A), while measurements from other excel sheets used animals of breed B.</p>
<p>Let us visually inspect whether the relationship between treatment and size is different for the two different breeds of animals. To this end, we do not modify the underlying excel sheets, rather we add the column <code>breed</code> to the <code>tibble</code>s when reading in the data from each excel sheet. The <code>breed</code> column should have the values <code>A</code> for the first four sheets and the value <code>B</code> for the remaining sheets respectively.</p>
<p>A first suggestion may be to simply keep track of at which of the excel sheets we are when looping over the <code>xls_sheet_list</code> variable which contains all the files (see section @ref{forLoop}), and then set the <code>breed</code> variable according to an <code>if</code> <code>else</code> statement (i.e., first 4 files <code>A</code>, remaining files <code>B</code>). However, if you look at the listing of files in section @ref{fileList} above, you will see that <code>sheet_10.xls</code> (breed <code>B</code>) is at the second position in the variable <code>xls_sheet_list</code>, so using a simple rule like that is not going to work.</p>
<div id="regular-expressions-to-the-rescue" class="section level3" number="4.9.1">
<h3><span class="header-section-number">4.9.1</span> Regular expressions to the rescue</h3>
<p>Hence, we need to inspect the filenames themselves and sort out <code>sheet_1.xls</code>, <code>sheet_2.xls</code>, <code>sheet_3.xls</code> and <code>sheet_4.xls</code> from the rest. How to do this? <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/regex.html">Regular expressions</a> are a great way to filter numbers from textual data.</p>
<p>While we are not delving into regular expressions now,</p>

<div id="refs" class="references csl-bib-body hanging-indent">
<div class="csl-entry">
Crawley, Michael J. 2013. <em>The <span>R</span> Book</em>. Chichester, UK: John Wiley &amp; Sons.
</div>
<div class="csl-entry">
Davies, Tilman M. 2016. <em>The Book of <span>R</span></em>. San Francisco, CA: No Starch Press.
</div>
<div class="csl-entry">
Matloff, Norman. 2011. <em>The Art of <span>R</span> Programming</em>. San Francisco: no starch press.
</div>
<div class="csl-entry">
Wickham, Hadley. 2019. <em>Advanced <span>R</span></em>. Boca Raton, FL: CRC Press. <a href="https://adv-r.hadley.nz/index.html">https://adv-r.hadley.nz/index.html</a>.
</div>
<div class="csl-entry">
Wickham, Hadley, and Garrett Grolemund. 2017. <em>R for Data Science</em>. Sebastopol, CA: O’Reilly. <a href="https://r4ds.had.co.nz/">https://r4ds.had.co.nz/</a>.
</div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="slightly-more-advanced-for-loops.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/03-datasets.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Some R exercises on looping constructs.pdf", "Some R exercises on looping constructs.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
